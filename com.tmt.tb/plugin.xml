<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         point="com.sg.bpm.service.actorRule">
      <actorRule
            actorIdProvider="com.tmt.tb.actor.DeptLeaderOfLauncher"
            id="dept_leader"
            name="流程发起人所在部门的管理者">
      </actorRule>
   </extension>
   <extension
         point="com.sg.bpm.workflow.taskForm">
      <taskForm
            editorId="tbprojectapplication.application"
            name="立项申请"
            persistentFields="prj_number"
            processDefinitionId="tb.tbProjectApplication">
         <processParameter
               processParameterName="prj_number"
               taskFormFieldName="prj_number">
         </processParameter>
      </taskForm>
      <taskForm
            editorId="tbprojectapplication.applicationdept"
            name="申请部门负责人审核"
            persistentFields="choice,comment"
            processDefinitionId="tb.tbProjectApplication">
         <processParameter
               processParameterName="choice"
               taskFormFieldName="choice">
         </processParameter>
      </taskForm>
      <taskForm
            editorId="tbprojectapplication.approve"
            name="批准"
            persistentFields="choice,comment,dept_leader,prj_admin,dept"
            processDefinitionId="tb.tbProjectApplication">
         <processParameter
               processParameterName="choice"
               taskFormFieldName="choice">
         </processParameter>
         <processParameter
               processParameterDelegator="com.tmt.tb.field.parameter.GetDeptLeaderByDepartmentOfTB"
               processParameterName="dept_leader"
               taskFormFieldName="dept_leader">
         </processParameter>
         <processParameter
               processParameterDelegator="com.tmt.tb.field.parameter.GetProjectAdminByDepartmentOfTB"
               processParameterName="prj_admin"
               taskFormFieldName="prj_admin">
         </processParameter>
         <processParameter
               processParameterDelegator="com.sg.business.commons.field.processparameterdelegator.ChangetToObjectId"
               processParameterName="dept"
               taskFormFieldName="dept">
         </processParameter>
      </taskForm>
      <taskForm
            editorId="tbprojectapplication.assign"
            name="指派项目负责人"
            persistentFields="prj_manager"
            processDefinitionId="tb.tbProjectApplication"
            saveHandler="com.tmt.tb.handler.ProjectApplicationAuditSaveOfTB">
         <processParameter
               processParameterName="prj_manager"
               taskFormFieldName="prj_manager">
         </processParameter>
      </taskForm>
      <taskForm
            editorId="tbprojectapplication.workorder"
            inputHandler="com.tmt.tb.handler.ProjectApplicationWorkOrderOfTB"
            name="审批工作令号"
            persistentFields="prj_number"
            processDefinitionId="tb.tbProjectApplication">
         <processParameter
               processParameterName="prj_number"
               taskFormFieldName="prj_number">
         </processParameter>
      </taskForm>
      <taskForm
            editorId="tbprojectapplication.createproject"
            name="创建项目"
            persistentFields="standloneworkdesc,standloneworkdescription,standloneworkplanstart,standloneworkplanfinish,projecttemplate_id,standardset,producttype,projecttype"
            processDefinitionId="tb.tbProjectApplication">
         <processParameter
               processParameterName="standloneworkdescription"
               taskFormFieldName="standloneworkdescription">
         </processParameter>
         <processParameter
               processParameterName="standloneworkplanstart"
               taskFormFieldName="standloneworkplanstart">
         </processParameter>
         <processParameter
               processParameterName="standloneworkplanfinish"
               taskFormFieldName="standloneworkplanfinish">
         </processParameter>
         <processParameter
               processParameterDelegator="com.sg.business.commons.field.processparameterdelegator.ChangetToObjectId"
               processParameterName="projecttemplate_id"
               taskFormFieldName="projecttemplate_id">
         </processParameter>
         <processParameter
               processParameterDelegator="com.sg.business.commons.field.processparameterdelegator.ChangetToList"
               processParameterName="standardset"
               taskFormFieldName="standardset">
         </processParameter>
         <processParameter
               processParameterDelegator="com.sg.business.commons.field.processparameterdelegator.ChangetToList"
               processParameterName="producttype"
               taskFormFieldName="producttype">
         </processParameter>
         <processParameter
               processParameterDelegator="com.sg.business.commons.field.processparameterdelegator.ChangetToList"
               processParameterName="projecttype"
               taskFormFieldName="projecttype">
         </processParameter>
         <processParameter
               processParameterName="standloneworkdesc"
               taskFormFieldName="standloneworkdesc">
         </processParameter>
      </taskForm>
   </extension>
   <extension
         point="com.sg.widgets.dataEditor">
      <editor
            collectionName="task"
            dbName="pm2"
            id="tbprojectapplication.application"
            name="立项申请">
         <basicpage
               id="page1"
               title="审核">
            <pagecolumn>
               <section
                     label="请填写工作令号">
                  <text
                        editPart="Text(Single Line)"
                        editable="true"
                        id="prj_number"
                        label="工作令号"
                        labelVisible="true"
                        name="prj_number"
                        persistable="true"
                        required="true"
                        type="String"
                        widthHint="320">
                  </text>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
      <editor
            collectionName="taskform"
            dbName="pm2"
            id="tbprojectapplication.applicationdept"
            name="申请部门负责人审核">
         <basicpage
               id="page1"
               title="审核">
            <pagecolumn>
               <section
                     label="请填写审核意见和结论">
                  <text
                        editPart="Text(Multi Line)"
                        editable="true"
                        id="comment"
                        label="审核意见"
                        labelVisible="false"
                        name="comment"
                        persistable="true"
                        required="false"
                        type="String"
                        widthHint="320">
                  </text>
                  <radio
                        editable="true"
                        id="choice"
                        label="审核结论"
                        labelVisible="false"
                        name="choice"
                        option="是否整改"
                        persistable="true"
                        required="true"
                        type="String">
                  </radio>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
      <editor
            collectionName="taskform"
            dbName="pm2"
            id="tbprojectapplication.approve"
            name="批准">
         <basicpage
               id="page1"
               title="审核">
            <pagecolumn>
               <section
                     label="请填写批准意见和结论">
                  <text
                        editPart="Text(Multi Line)"
                        editable="true"
                        id="comment"
                        label="审核意见"
                        labelVisible="false"
                        name="comment"
                        persistable="true"
                        required="false"
                        type="String"
                        widthHint="320">
                  </text>
                  <radio
                        editable="true"
                        id="choice"
                        label="审核结论"
                        labelVisible="false"
                        name="choice"
                        option="是否整改"
                        persistable="true"
                        required="true"
                        type="String">
                  </radio>
               </section>
               <section
                     label="请选择分发部门">
                  <navigatorSelector
                        editable="true"
                        id="dept"
                        label="分发部门"
                        labelVisible="true"
                        modelClass="com.sg.business.model.Organization"
                        name="dept"
                        navigatorId="tb.taskforms.organization.selector"
                        navigatorReturnField="_id"
                        persistable="true"
                        required="false">
                  </navigatorSelector>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
      <editor
            collectionName="taskform"
            dbName="pm2"
            id="tbprojectapplication.assign"
            name="指派项目负责人">
         <basicpage
               id="page1"
               title="审核">
            <pagecolumn>
               <section
                     label="请指派项目经理">
                  <navigatorSelector
                        editable="true"
                        id="prj_manager"
                        label="项目经理"
                        labelVisible="true"
                        labelprovider="com.sg.business.commons.labelprovider.UserIdLabelProvider"
                        modelClass="com.sg.business.model.User"
                        name="prj_manager"
                        navigatorId="tb.taskforms.user.selector"
                        navigatorReturnField="userid"
                        persistable="true"
                        required="true">
                  </navigatorSelector>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
      <editor
            collectionName="task"
            dbName="pm2"
            id="tbprojectapplication.workorder"
            name="审批工作令号">
         <basicpage
               id="page1"
               title="审核">
            <pagecolumn>
               <section
                     label="请确认工作令号">
                  <text
                        editPart="Text(Single Line)"
                        editable="true"
                        id="prj_number"
                        label="工作令号"
                        labelVisible="true"
                        name="prj_number"
                        persistable="true"
                        required="true"
                        type="String"
                        widthHint="320">
                  </text>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
      <editor
            collectionName="task"
            dbName="pm2"
            id="tbprojectapplication.createproject"
            name="创建项目">
         <basicpage
               description="项目的基本信息"
               id="project.basicpage.1"
               title="基本">
            <pagecolumn>
               <section
                     label="项目摘要">
                  <text
                        editPart="Text(Single Line)"
                        editable="true"
                        id="standloneworkdesc"
                        label="项目名称"
                        labelVisible="true"
                        name="standloneworkdesc"
                        persistable="true"
                        required="true"
                        type="String">
                  </text>
                  <text
                        editPart="Text(Multi Line)"
                        editable="true"
                        id="standloneworkdescription"
                        label="描述"
                        labelVisible="true"
                        name="standloneworkdescription"
                        persistable="true"
                        required="false"
                        type="String">
                  </text>
               </section>
               <section
                     label="计划">
                  <dateTime
                        editPart="DateDialog"
                        editable="true"
                        id="standloneworkplanstart"
                        label="计划开始"
                        labelVisible="true"
                        name="standloneworkplanstart"
                        persistable="true"
                        required="true"
                        type="Date">
                  </dateTime>
                  <dateTime
                        editPart="DateDialog"
                        editable="true"
                        id="standloneworkplanfinish"
                        label="计划完成"
                        labelVisible="true"
                        name="standloneworkplanfinish"
                        persistable="true"
                        required="true"
                        type="Date">
                  </dateTime>
               </section>
               <section
                     label="项目模板">
                  <combo
                        dataSetFactory="com.tmt.tb.dataset.StandloneWorkOfTB"
                        editPart="Combo(Read Only)"
                        editable="true"
                        id="projecttemplate_id"
                        isComputeField="true"
                        label="项目模板"
                        labelVisible="true"
                        name="projecttemplate_id"
                        persistable="true"
                        required="true"
                        type="ObjectId">
                  </combo>
               </section>
            </pagecolumn>
         </basicpage>
         <basicpage
               description="您选择的模板提供了以下选项，请确定选择"
               id="project.basicpage.3"
               pageDelegator="com.tmt.tb.editor.page.StandloneWorkPageOfTB"
               title="选项">
         </basicpage>
         <basicpage
               id="page2"
               pageDelegator="com.sg.business.commons.editor.page.WorkFlowRecord"
               title="流程记录">
         </basicpage>
      </editor>
   </extension>
   <extension
         point="com.sg.widgets.navigator">
      <navigator
            id="tb.taskforms.organization.selector"
            tree="tb.taskforms.organization.selector">
         <filterAction>
            <column
                  columnDefinitionId="com.sg.widgets.column.desc">
            </column>
            <column
                  columnDefinitionId="organization.organizationType">
            </column>
            <column
                  columnDefinitionId="organization.isFunctionDepartment">
            </column>
            <column
                  columnDefinitionId="organization.isContainer">
            </column>
            <column
                  columnDefinitionId="organization.description">
            </column>
            <column
                  columnDefinitionId="organization.costCenterCode">
            </column>
         </filterAction>
         <searchAction>
            <column
                  columnDefinitionId="com.sg.widgets.column.desc">
            </column>
            <column
                  columnDefinitionId="organization.organizationType">
            </column>
            <column
                  columnDefinitionId="organization.isFunctionDepartment">
            </column>
            <column
                  columnDefinitionId="organization.isContainer">
            </column>
            <column
                  columnDefinitionId="organization.description">
            </column>
            <column
                  columnDefinitionId="organization.costCenterCode">
            </column>
         </searchAction>
      </navigator>
      <navigator
            id="tb.taskforms.user.selector"
            tree="tb.taskforms.user.selector">
         <filterAction>
            <column
                  columnDefinitionId="account.userid">
            </column>
            <column
                  columnDefinitionId="account.username">
            </column>
         </filterAction>
         <searchAction>
            <column
                  columnDefinitionId="account.userid">
            </column>
            <column
                  columnDefinitionId="account.username">
            </column>
         </searchAction>
      </navigator>
   </extension>
   <extension
         point="com.sg.widgets.tree">
      <tree
            dataSet="com.tmt.tb.dataset.OrganizationSelectorOfTaskforms"
            headerVisiable="false"
            id="tb.taskforms.organization.selector">
         <column
               columnDefinitionId="com.sg.widgets.commonlabel">
         </column>
         <structure
               modelRelation="organization_organization">
         </structure>
      </tree>
      <tree
            dataSet="com.tmt.tb.dataset.UserSelectorOfTaskforms"
            headerVisiable="false"
            id="tb.taskforms.user.selector">
         <column
               columnDefinitionId="com.sg.widgets.commonlabel">
         </column>
         <structure
               modelRelation="organization_organization">
         </structure>
         <structure
               modelRelation="organization_user">
         </structure>
      </tree>
   </extension>
   <extension
         point="com.sg.bpm.service.serviceTask">
      <service
            interface="createproject.service.action"
            name="自动生成项目"
            operation="tbprojectapplication"
            serviceProvider="com.tmt.tb.bpmservice.CreateProjectOfTB">
      </service>
      <service
            interface="tbmessage.service.action"
            name="立项审批拒绝消息"
            operation="applicationcancelmessage"
            serviceProvider="com.tmt.tb.bpmservice.ApplicationMessageOfTB">
      </service>
      <service
            interface="tbmessage.service.action"
            name="立项审批通过消息"
            operation="applicationfinishmessage"
            serviceProvider="com.tmt.tb.bpmservice.ApplicationMessageOfTB">
      </service>
   </extension>

</plugin>
